<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Page 1 | CATSLAB BLOG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="CATSLAB BLOG">
<meta property="og:url" content="https://cantapiya.github.io/catslab_blog/index.html">
<meta property="og:site_name" content="CATSLAB BLOG">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CATSLAB BLOG">
  
    <link rel="alternate" href="/atom.xml" title="CATSLAB BLOG" type="application/atom+xml">
  
  <link rel="icon" href="/catslab_blog/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/catslab_blog/css/style.css">

  <script src="/catslab_blog/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/catslab_blog/css/bootstrap.css">
  <link rel="stylesheet" href="/catslab_blog/css/fashion.css">
  <link rel="stylesheet" href="/catslab_blog/css/glyphs.css">

</head>
</html>


  <body>


  


<header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/catslab_blog/" title="CATSLAB BLOG" rel="home"> CATSLAB BLOG </a>
            
          </h1>
          
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows" style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/catslab_blog/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/catslab_blog/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/catslab_blog/categories">Categories</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/catslab_blog/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/catslab_blog/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main">
  
    <article id="post-k8s-AWS-settings" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/catslab_blog/k8s-AWS-settings/">AWS Settings and Installation</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/catslab_blog/k8s-AWS-settings/" class="article-date">
	  <time datetime="2019-04-26T22:00:00.000Z" itemprop="datePublished">April 27, 2019</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/Kubernetes/">Kubernetes</a>, <a class="article-category-link" href="/catslab_blog/categories/Kubernetes/AWS-Settings-Installation/">AWS Settings & Installation</a>
 
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="AWS-인스턴스-생성-및-구동하기"><a href="#AWS-인스턴스-생성-및-구동하기" class="headerlink" title="AWS 인스턴스 생성 및 구동하기"></a>AWS 인스턴스 생성 및 구동하기</h2><p>먼저 AWS 루트 사용자 로그인을 진행합니다.<br>로그인 후 인스턴스 생성을 위해 다음 과정을 진행합니다.</p>
<ul>
<li>“AWS Management Console - 솔루션 구축 : EC2 사용하여”를 진행합니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56702818-0111f500-6741-11e9-8686-64f4a0b74c6a.png" alt="시작: 솔루션 구축"></p>
<h3 id="단계-1-Amazon-Machine-Image-AMI-선택"><a href="#단계-1-Amazon-Machine-Image-AMI-선택" class="headerlink" title="단계 1: Amazon Machine Image(AMI) 선택"></a>단계 1: Amazon Machine Image(AMI) 선택</h3><ul>
<li>“Ubuntu Server 18.04 LTS (HVM), SSD Volume Type -ami- (64비트(x86))”를 선택합니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56702865-2999ef00-6741-11e9-906a-7cc6ca81b5f5.png" alt="단계 1: AMI 선택"></p>
<h2 id="단계-2-인스턴스-유형-선택"><a href="#단계-2-인스턴스-유형-선택" class="headerlink" title="단계 2: 인스턴스 유형 선택"></a>단계 2: 인스턴스 유형 선택</h2><ul>
<li>“t2.micro” 유형을 선택 후 “검토 및 시작”을 진행합니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56702902-636af580-6741-11e9-8e28-c06131186a03.png" alt="단계 2: 인스턴스 유형 선택"></p>
<h2 id="단계-7-인스턴스-시작-검토"><a href="#단계-7-인스턴스-시작-검토" class="headerlink" title="단계 7: 인스턴스 시작 검토"></a>단계 7: 인스턴스 시작 검토</h2><ul>
<li>선택 사항을 확인 후 시작하기를 통해 다음 단계를 진행합니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56703073-2fdc9b00-6742-11e9-8053-d57944fbb32c.png" alt="단계 7: 인스턴스 시작 검토"></p>
<ul>
<li><p>기존 키 페어 선택 또는 새 키 페어 생성을 진행합니다.</p>
</li>
<li><p>기존에 사용하는 키 페어가 없는 경우 새 키 페어 생성 후 키 페어 다운로드를 진행합니다. </p>
</li>
<li><p>키 페어 이름을 설정한 뒤 프라이빗 키 파일(*.pem)을 다운로드 후 인스턴스를 시작합니다.</p>
</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56703160-a2e61180-6742-11e9-8039-5f32696a4949.png" alt="기존 키 페어 선택 또는 새 키 페어 생성"></p>
<ul>
<li>인스턴스 시작 후 인스턴스 탭에서 생성된 인스턴스의 정보를 확인하고, 인스턴스 보기를 진행하여 생성한 인스턴스를 확인합니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56703219-d7f26400-6742-11e9-82f1-e5c5156da25d.png" alt="인스턴스 정보 확인"></p>
<ul>
<li>인스턴스가 생성이 되어 시작 중(pending) 상태에서 사용할 준비가 되면 실행 중(running) 상태로 변경됩니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56703279-0a03c600-6743-11e9-86e7-aa75f519a05e.png" alt="인스턴스 보기"></p>
<ul>
<li>생성한 인스턴스의 IPv4 퍼블릭 IP을 이용하여 인스턴스에 접속이 가능합니다. (pem키를 생성하여 보관, pem키를 통하여 접속)</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56703330-3c152800-6743-11e9-83b8-814bdac5cf1a.png" alt="IPv4 퍼블릭 IP 확인"></p>
<ul>
<li>다음 명령어를 통해 생성한 인스턴스로 접속할 수 있습니다.</li>
</ul>
<p><code>~$ sudo ssh -i [KEY_PAIR_NAME].pem ubuntu@[IPv4 퍼블릭 IP]</code></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56703430-b5147f80-6743-11e9-877e-2b769593d779.png" alt="인스턴스 접속"></p>
<h2 id="kops-설치-및-kubectl-설치"><a href="#kops-설치-및-kubectl-설치" class="headerlink" title="kops 설치 및 kubectl 설치"></a>kops 설치 및 kubectl 설치</h2><h3 id="kops-설치"><a href="#kops-설치" class="headerlink" title="kops 설치"></a>kops 설치</h3><p>kops는 Kubernetes 클러스터를 만들어 주는 CLI 도구이며, 실행 파일 하나만 다운 받으면 됩니다.</p>
<hr>
<p><code>~$ wget -O kops https://github.com/kubernetes/kops/releases/download/$(curl -s https://api.github.com/repos/kubernetes/kops/releases/latest | grep tag_name | cut -d &#39;&quot;&#39; -f 4)/kops-linux-amd64</code><br><code>~$ chmod +x ./kops</code><br><code>~$ sudo mv ./kops /usr/local/bin/</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56703639-cc07a180-6744-11e9-91d8-3d8377ca6a66.png" alt="kops 설치"></p>
<h3 id="kubectl-설치"><a href="#kubectl-설치" class="headerlink" title="kubectl 설치"></a>kubectl 설치</h3><p>kubectl은 이미 만들어져 있는 Kubernetes 클러스터를 관리하기 위한 도구이며, 다음을 실행하여 실행 파일 하나만 다운 받으면 됩니다. </p>
<hr>
<p><code>~$ wget -O kubectl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl</code><br><code>~$ chmod +x ./kubectl</code><br><code>~$ sudo mv ./kubectl /usr/local/bin/kubectl</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56703670-eccff700-6744-11e9-9edb-52eb8ad429ff.png" alt="kubectl 설치"></p>
<h2 id="IAM-유저-생성"><a href="#IAM-유저-생성" class="headerlink" title="IAM 유저 생성"></a>IAM 유저 생성</h2><p>kops가 동작하기 위해서는 AWS 권한이 필요하고 따라서 적당한 권한을 가지고 있는 IAM 유저를 생성해야 합니다.</p>
<ul>
<li>AWS 웹 콘솔에서 서비스 페이지를 열고 “보안, 자격 증명 및 규정 준수” 탭에서 “IAM”을 선택하여 IAM 유저 생성을 진행합니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56703795-6cf65c80-6745-11e9-85a6-f0d0d699fe68.png" alt="IAM 유저 생성 01"></p>
<ul>
<li>“사용자” 탭에서 “사용자 추가”를 진행합니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56703833-a7f89000-6745-11e9-8026-f1784b026778.png" alt="IAM 유저 생성 02"></p>
<ul>
<li>kops라는 사용자 이름을 추가하고 그룹에 사용자 추가를 진행하여 다음 권한을 가지고 있는 kops라는 그룹을 생성합니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56704144-fce8d600-6746-11e9-8f0a-98662c01f6be.png" alt="IAM 유저 생성 03"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56704158-0c681f00-6747-11e9-8b12-76aea3b616df.png" alt="IAM 유저 생성 04"></p>
<p>검색창에 다음 정책들을 검색하여 권한을 설정합니다.</p>
<hr>
<p>AmazonEC2FullAccess<br>AmazonRoute53FullAccess<br>AmazonS3FullAccess<br>IAMFullAccess<br>AmazonVPCFullAccess</p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56704208-3cafbd80-6747-11e9-9f52-1c91591c9734.png" alt="IAM 유저 생성 05"></p>
<ul>
<li>kops 그룹에 속한 kops라는 유저를 만들고 Access key ID와 Secret access key를 저장해 둡니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56704242-5a7d2280-6747-11e9-9c08-a18f0d3f7bc8.png" alt="IAM 유저 생성 06"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56704292-85677680-6747-11e9-8f89-3f189cb746fd.png" alt="IAM 유저 생성 07"></p>
<ul>
<li>사용자 만들기를 진행하여 액세스 키 ID와 비밀 액세스 키를 확인 후 저장해 둡니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56704330-ab8d1680-6747-11e9-9880-a34c59cf5297.png" alt="IAM 유저 생성 08"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56704438-10e10780-6748-11e9-853a-0f54ea699a33.png" alt="IAM 유저 생성 09"></p>
<ul>
<li>다음과 같이 kops 그룹에 kops 사용자가 추가되어 있는 것을 확인할 수 있습니다.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/47657715/56704462-29512200-6748-11e9-9ea9-1e83d9ce0787.png" alt="IAM 유저 생성 10"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56704465-2d7d3f80-6748-11e9-8ed0-04580845fd95.png" alt="IAM 유저 생성 11"></p>
<h3 id="AWS-CLI-설치"><a href="#AWS-CLI-설치" class="headerlink" title="AWS CLI 설치"></a>AWS CLI 설치</h3><p>클러스터를 생성하는 과정에서 AWS CLI가 필요합니다.  </p>
<p>AWS CLI 설치를 위해 다음을 실행하여 설치합니다.  </p>
<hr>
<p><code>~$ sudo apt update</code><br><code>~$ sudo apt install -y python-pip</code><br><code>~$ pip install awscli</code></p>
<hr>
<p>설치 후 aws 명령을 찾지 못한 경우 다시 로그인해 봅니다. (인스턴스 재접속)</p>
<p><img src="https://user-images.githubusercontent.com/47657715/56705214-0d9b4b00-674b-11e9-818f-0cd41c951930.png" alt="AWS CLI 설치">  </p>
<p>aws 환경 설정을 위해 aws configure를 입력 후 필요한 항목들을 입력합니다.  </p>
<p>AWS Access Key ID와 AWS Secret Access Key에는 IAM 그룹 및 사용자 설정 시 발급받은 Access Key와 Secret Access Key를 입력합니다.  </p>
<hr>
<p><code>~$ aws configure</code><br><code>~$ AWS Access Key ID [None]: &lt;Your access key id&gt;</code><br><code>~$ AWS Secret Access Key [None]: &lt;Your secret access key&gt;</code><br><code>~$ Default region name [None]: ap-northeast-2</code><br><code>~$ Default output format [None]:</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56705288-505d2300-674b-11e9-9e27-8ccf26f10a57.png" alt="AWS 환경설정">  </p>
<p>환경설정이 제대로 되었는지 다음과 같은 명령어를 통해 확인해 볼 수 있습니다.  </p>
<hr>
<p><code>~$ aws ec2 describe-instances</code><br><code>~$ aws iam list-users</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56705373-95815500-674b-11e9-87b7-8eed8984bdc7.png" alt="AWS 환경설정 확인 01"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56705377-97e3af00-674b-11e9-8bdf-355ceba7dc78.png" alt="AWS 환경설정 확인 02">  </p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/Kubernetes/">Kubernetes</a>, <a class="article-category-link" href="/catslab_blog/categories/Kubernetes/AWS-Settings-Installation/">AWS Settings & Installation</a>

      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-k8s-kops-cluster" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/catslab_blog/k8s-kops-cluster/">k8s Cluster on AWS with Kops</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/catslab_blog/k8s-kops-cluster/" class="article-date">
	  <time datetime="2019-04-26T22:00:00.000Z" itemprop="datePublished">April 27, 2019</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/Kubernetes/">Kubernetes</a>, <a class="article-category-link" href="/catslab_blog/categories/Kubernetes/k8s-Cluster-on-AWS-with-Kops/">k8s Cluster on AWS with Kops</a>
 
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Kops-이용하여-Cluster-생성하기"><a href="#Kops-이용하여-Cluster-생성하기" class="headerlink" title="Kops 이용하여 Cluster 생성하기"></a>Kops 이용하여 Cluster 생성하기</h2><p><a href="https://cantapiya.github.io/catslab_blog/k8s-AWS-settings/">AWS Settings and Installation</a>를 통해 AWS 환경설정 및 kops, kubectl, AWS CLI의 설치가 완료되었으면 kops를 이용하여 클러스터 구축을 진행합니다.</p>
<h3 id="S3-버킷-생성"><a href="#S3-버킷-생성" class="headerlink" title="S3 버킷 생성"></a>S3 버킷 생성</h3><p>클러스터를 생성하기 위해 S3 버킷을 생성하고, 환경 변수를 설정 및 SSH Key Pair를 생성 후 클러스터를 생성합니다.  </p>
<p>먼저 클러스터의 정보를 저장할 저장소가 필요한데, kops는 S3를 사용하므로 다음 명령어로 bucket을 생성하고 Versioning 기능도 활성화합니다.  </p>
<hr>
<p><code>~$ aws s3api create-bucket \</code><br><code>--bucket &lt;bucket name&gt; \</code><br><code>--region ap-northeast-2 \</code><br><code>--create-bucket-configuration LocationConstraint=ap-northeast-2</code></p>
<p><code>~$ aws s3api put-bucket-versioning \</code><br><code>--bucket &lt;bucket name&gt; \</code><br><code>--versioning-configuration Status=Enabled</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56706446-fad74500-674f-11e9-8d80-bee33bb67dc9.png" alt="S3 버킷 생성 01"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56706448-fc087200-674f-11e9-971d-16489148fb55.png" alt="S3 버킷 생성 02">  </p>
<h3 id="환경-변수-설정"><a href="#환경-변수-설정" class="headerlink" title="환경 변수 설정"></a>환경 변수 설정</h3><p>kops가 AWS API를 쓰기 위한 환경 변수를 설정합니다. </p>
<hr>
<p><code>~$ export AWS_ACCESS_KEY_ID=$(aws configure get aws_access_key_id)</code><br><code>~$ export AWS_SECRET_ACCESS_KEY=$(aws configure get aws_secret_access_key)</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56706497-29552000-6750-11e9-9952-53f623d5dc1b.png" alt="환경 변수 설정 01">  </p>
<p>작업을 편리하게 하기 위해 아래 환경 변수도 생성합니다. </p>
<p>Gossip 기반 클러스터를 사용할 계획이기 때문에 클러스터 이름은 .k8s.local로 입력합니다. (예: myfirstcluster.k8s.local)<br>bucket name에는 위의 S3 버킷 생성 과정에서 입력한 bucket name을 입력합니다.</p>
<p><img src="https://user-images.githubusercontent.com/47657715/56706513-35d97880-6750-11e9-9d77-8b5156e12996.png" alt="환경 변수 설정 02">  </p>
<h3 id="SSH-Key-Pair-생성"><a href="#SSH-Key-Pair-생성" class="headerlink" title="SSH Key Pair 생성"></a>SSH Key Pair 생성</h3><p>생성해둔 SSH Key Pair가 없다면 클러스터 생성을 시작하기 전에 ssh-keygen 을 통해 미리 생성해 둡니다.</p>
<hr>
<p><code>~$ ssh-keygen</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56706590-851fa900-6750-11e9-9a0a-e84582783097.png" alt="SSH Key Pair 생성">  </p>
<h3 id="클러스터-생성"><a href="#클러스터-생성" class="headerlink" title="클러스터 생성"></a>클러스터 생성</h3><p>다음 명령어를 이용하여 클러스터를 생성합니다. 클러스터를 생성한 Availability Zone을 지정해야 하는데 ap-northeast-2c (Seoul)만 지정합니다. </p>
<p>이 명령어를 입력하면 클러스터가 바로 생성되는 것은 아니고 생성을 위한 설정들이 만들어집니다.</p>
<hr>
<p><code>~$ kops create cluster --zones ap-northeast-2c ${NAME}</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56706660-c0ba7300-6750-11e9-887e-382ce80c33ab.png" alt><br>…<br><img src="https://user-images.githubusercontent.com/47657715/56706673-ce6ff880-6750-11e9-9d3a-0c3a9a879500.png" alt="클러스터 설정 생성">  </p>
<p>클러스터 설정을 확인하거나 수정하고 싶으면 다음 명령어를 입력합니다.  </p>
<hr>
<p><code>~$ kops edit cluster ${NAME}</code></p>
<hr>
<p>다음 명령어로 생성될 인스턴스 그룹을 확인할 수 있습니다.  </p>
<hr>
<p><code>~$ kops get ig --name ${NAME}</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56706758-168f1b00-6751-11e9-9d8c-950284d4bfe4.png" alt="인스턴스 그룹 확인">  </p>
<p>기본 설정은 c4.large 타입 마스터 노드 1개와 t2.medium 워커 노드 2개가 생성되게 되어있습니다. CATSLAB 서비스에 가동하기 위해 t2.medium 타입 마스터 노드 1개와 t2.medium 타입 워커 노드 2개를 생성합니다.  </p>
<p>다음 명령어를 통해 마스터 노드와 워커 노드의 설정을 변경합니다.  </p>
<hr>
<p><code>~$ kops edit ig master-ap-northeast-2c --name ${NAME}</code><br><code>~$ kops edit ig nodes --name ${NAME}</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56706793-3d4d5180-6751-11e9-9b11-5268a7e5746d.png" alt="인스턴스 그룹 설정 변경 01"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56706828-6241c480-6751-11e9-9830-3e259e861956.png" alt="인스턴스 그룹 설정 변경 02 - master node"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56706856-784f8500-6751-11e9-811b-36d9e890ddd7.png" alt="인스턴스 그룹 설정 변경 03 - worker node">  </p>
<p>생성할 클러스터의 설정을 변경한 후 다음 명령어를 통해 클러스터 생성합니다.  </p>
<hr>
<p><code>~$ kops update cluster ${NAME} --yes</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56706917-b2208b80-6751-11e9-9a15-d1215e4e946f.png" alt="클러스터 생성">  </p>
<p>클러스터 생성이 완료될 때까지는 어느 정도의 시간이 소요됩니다.</p>
<p>클러스터가 잘 생성되었는지 확인하기 위해 다음 명령어들을 이용하여 클러스터 상태를 확인합니다.</p>
<hr>
<p><code>~$ kops validate cluster            # 클러스터 상태 확인</code><br><code>~$ kubectl get nodes --show-labels  # 노드 목록 가져오기</code><br><code>~$ kubectl -n kube-system get po    # kube-system 네임스페이스 안의 Pod 목록</code></p>
<hr>
<p>인스턴스가 실행 중으로 바뀌고 노드들 간에 결합이 완료되면 다음과 같이 cluster가 잘 생성된 것을 확인할 수 있습니다.  </p>
<p><img src="https://user-images.githubusercontent.com/47657715/56706960-edbb5580-6751-11e9-8e38-a7ab1551da6c.png" alt="생성된 cluster 확인"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56706963-f1e77300-6751-11e9-8d5e-613a0ea1b0db.png" alt="생성된 node 확인"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56706990-0f1c4180-6752-11e9-939e-d38abdb9a0c7.png" alt="생성된 pod 확인">  </p>
<p><img src="https://user-images.githubusercontent.com/47657715/56707006-252a0200-6752-11e9-8629-7fb7d2b12307.png" alt="AWS 인스턴스 생성 확인">  </p>
<p>클러스터가 생성되면 다음과 같은 명령어로 생성한 마스터 노드에 접속이 가능합니다.  </p>
<hr>
<p><code>~$ ssh admin@[Master Node IP]</code></p>
<hr>
<h3 id="클러스터-삭제"><a href="#클러스터-삭제" class="headerlink" title="클러스터 삭제"></a>클러스터 삭제</h3><p>다음 명령어를 통해 클러스터를 삭제할 수 있습니다.  </p>
<hr>
<p><code>~$ kops delete cluster --name ${NAME} --yes</code></p>
<hr>
<p>kops를 이용하여 생성한 클러스터는 자동 복구(self-healing) 메커니즘으로 가동되기 때문에 구동 중인 노드가 다운되거나 삭제되더라도 자동으로 인스턴스를 교체해 줍니다. 그렇기 때문에 확실하게 클러스터의 가동을 중단시키기 위해서는 클러스터를 구성한 kops 마스터 노드에서 위의 명령어를 통해 클러스터를 삭제하는 것이 안전합니다.  </p>
<p>kops 설치 및 cluster를 생성한 master 노드 역시 다음 명령어를 통해 종료할 수 있습니다.  </p>
<hr>
<p><code>~$ sudo systemctl poweroff</code></p>
<hr>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/Kubernetes/">Kubernetes</a>, <a class="article-category-link" href="/catslab_blog/categories/Kubernetes/k8s-Cluster-on-AWS-with-Kops/">k8s Cluster on AWS with Kops</a>

      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-catslab-package-installation" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/catslab_blog/catslab-package-installation/">CATS Lab Package Installation</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/catslab_blog/catslab-package-installation/" class="article-date">
	  <time datetime="2019-04-25T22:00:00.000Z" itemprop="datePublished">April 26, 2019</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Installation/">Installation</a>
 
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="CATS-Lab-Package-설치"><a href="#CATS-Lab-Package-설치" class="headerlink" title="CATS Lab Package 설치"></a>CATS Lab Package 설치</h2><p>우선 CATS Lab 패키지를 설치하기 위해 <a href="https://git-scm.com/downloads" target="_blank" rel="noopener">Git Download</a>에서 Git을 다운로드합니다.</p>
<p><img src="https://user-images.githubusercontent.com/47657715/56722755-ab5e3c80-6782-11e9-980a-9f91bbea76e4.png" alt="Git 설치 완료">  </p>
<p><a href="https://github.com/Derek-tjhwang/CATS-LAB" target="_blank" rel="noopener">CATS Lab Github</a> 페이지에서 git clone을 이용하여 설치에 필요한 파일들을 내려받습니다.</p>
<hr>
<p><code>~$ git clone https://github.com/Derek-tjhwang/CATS-LAB.git</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56722802-c3ce5700-6782-11e9-93f0-5e94b15e03a7.png" alt="git clone [REPOSITORY]">  </p>
<p>CATS-LAB 디렉토리로 이동 후 다음 명령어를 실행시킵니다.<br>(python ver. 3.6.4과 pip, 그리고, 아래 명령어 실행을 위한 python package인 setuptools이 설치된 환경을 전제로 합니다.) </p>
<hr>
<p><code>~$ cd CATS-LAB</code><br><code>~$ python setup.py sdist</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56723358-c41b2200-6783-11e9-8f52-395d1ce103b2.png" alt>  </p>
<p>새로 생성된 dist 디렉토리로 이동 후 다음 명령어를 입력하여 CATS Lab package를 설치합니다.</p>
<hr>
<p><code>~$ cd dist</code><br><code>~$ pip install coza-0.2.tar.gz</code></p>
<hr>
<p><img src="https://user-images.githubusercontent.com/47657715/56723116-4d7e2480-6783-11e9-870e-7bfdfe618cd8.png" alt="CATS Lab Package 설치">  </p>
<h2 id="CATS-Lab-Sign-Up"><a href="#CATS-Lab-Sign-Up" class="headerlink" title="CATS Lab Sign Up"></a>CATS Lab Sign Up</h2><p>CATS Lab 패키지를 사용하기 위해서는 CATS Lab UUID와 사용할 BOT의 BOT ID가 필요합니다.</p>
<p>이를 발급받기 위해 우선 <a href="https://coza.me/home" target="_blank" rel="noopener">CATS Lab</a> 사이트에서 로그인 후 UUID와 BOT ID를 발급 받습니다.</p>
<h2 id="환경변수-설정"><a href="#환경변수-설정" class="headerlink" title="환경변수 설정"></a>환경변수 설정</h2><p>CATS Lab 패키지를 설치한 후 패키지에서 사용할 환경변수를 설정합니다. </p>
<p>필요한 환경변수로는 CATS Lab API Server의 Host와 Secret Key, 위의 과정에서 발급받은 UUID와 BOT ID입니다.</p>
<p>다음과 같이 환경변수를 등록 후 CATS Lab 패키지를 사용할 수 있습니다.</p>
<hr>
<p><code>export COZA_HOST=&quot;http://api.coza.me&quot;</code><br><code>export COZA_SECRET=SECRET_KEY</code><br><code>export COZA_USER_UUID=USER_UUID</code><br><code>export COZA_BOT_ID=BOT_ID</code></p>
<hr>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Installation/">Installation</a>

      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-catslab-trade-00-base-post" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/catslab_blog/catslab-trade-00-base-post/">A.0 Trade Basic</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/catslab_blog/catslab-trade-00-base-post/" class="article-date">
	  <time datetime="2019-02-26T00:00:00.000Z" itemprop="datePublished">February 26, 2019</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>
 
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="A-0-COZA-package-및-필요한-모듈-및-함수-import"><a href="#A-0-COZA-package-및-필요한-모듈-및-함수-import" class="headerlink" title="A.0. COZA package 및 필요한 모듈 및 함수 import"></a>A.0. COZA package 및 필요한 모듈 및 함수 import</h2><ul>
<li>필수</li>
</ul>
<p>BotContext 생성을 위해 import 합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> coza.bot <span class="keyword">import</span> BotContext</span><br></pre></td></tr></table></figure>
<p>거래소에 주문을 넣기 위한 Order 객체를 import 합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> coza.objects <span class="keyword">import</span> Order</span><br></pre></td></tr></table></figure>
<p>부가적으로 사용할 패키지 내의 객체나 함수 및 전략에서 이용할 TA들을 import 합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> coza.ta <span class="keyword">import</span> (TA_NAME)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>

      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-catslab-trade-01-botcontext-post" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/catslab_blog/catslab-trade-01-botcontext-post/">A.1 BotContext의 생성</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/catslab_blog/catslab-trade-01-botcontext-post/" class="article-date">
	  <time datetime="2019-02-25T23:00:00.000Z" itemprop="datePublished">February 26, 2019</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>
 
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="A-1-BotContext의-생성"><a href="#A-1-BotContext의-생성" class="headerlink" title="A.1. BotContext의 생성"></a>A.1. BotContext의 생성</h2><p>BOT_NAME을 지정하여 아래의 parameter를 입력하여 BotContext를 생성할 수 있습니다.<br>생성과 동시에 전략에서 사용할 가상화폐와 분봉들의 dataframe을 로드하여 저장합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BOT_NAME = BotContext(api_key, </span><br><span class="line">		secret_key, </span><br><span class="line">		init_budget, </span><br><span class="line">		exchange, </span><br><span class="line">		initialize, </span><br><span class="line">		run_strategy, </span><br><span class="line">		make_orders)</span><br></pre></td></tr></table></figure>
<p><strong>A.1.1. api_key (str)</strong><br>거래소로부터 발급 받은 사용자의 거래소 api key를 입력합니다.</p>
<p><strong>A.1.2. secret_key (str)</strong><br>거래소로부터 발급 받은 사용자의 거래소 secret key를 입력합니다.</p>
<p><strong>A.1.3. init_budget (int)</strong><br>사용자의 Bot에서 사용할 자산의 초기 투입 금액을 입력합니다.</p>
<p><strong>A.1.4. exchange (str)</strong><br>Bot에서 가상 화폐 거래를 할 때 이용할 거래소의 명칭을 입력합니다.<br>(해당 거래소에서 발급 받은 api key, secret key를 위의 입력 값으로 사용합니다.) </p>
<p><strong>A.1.5. initialize</strong><br>사용자가 Bot을 생성할 때 전략에서 사용할 가상화폐의 종류, 분봉, 거래소의 기축 화폐에 대한 정보와 safety setting에 대한 정보를 저장하는 함수입니다.</p>
<p>자세한 설명과 작성 예시는 A.3. initialize를 참고하시기 바랍니다.</p>
<p><strong>A.1.6. run_strategy</strong><br>Bot에서 사용하는 전략에서 매수 및 매도를 위해 참고할 기술적 지표를 계산하여 저장하는 함수입니다.  </p>
<p>자세한 설명과 작성 예시는 A.4. run_strategy를 참고하시기 바랍니다.</p>
<p><strong>A.1.7. make_orders</strong><br>사용자가 정한 방식에 따라 매수주문/매도주문/주문취소 등을 진행하는 함수입니다.  </p>
<p>자세한 설명과 작성 예시는 A.5. make_orders를 참고하시기 바랍니다.</p>
<p>dataframe에 접근하는 방식은 우선 BotContext를 생성할 때의 BOT_NAME class에서 exchanges로 접근하여 Bot에서 사용하는 거래소별 객체로 접근할 수 있습니다.<br>각 거래소에서 data로 접근하여 ‘{currency}_{interval}’ 형태의  key값으로 가상화폐 별, 분봉 별 dataframe에 접근이 가능합니다.</p>
<p>생성된 dataframe의 형태는 다음과 같습니다.</p>
<p><img src="https://user-images.githubusercontent.com/47657715/56643016-b8f8c100-66b3-11e9-992d-4ba72e3181a7.png" alt="A.1 DataFrame Example1"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56643020-bac28480-66b3-11e9-9c0b-e57081285884.png" alt="A.1 DataFrame Example2"></p>
<p><img src="https://user-images.githubusercontent.com/47657715/56643084-db8ada00-66b3-11e9-8f02-21c2f7cc6972.png" alt="A.1 DataFrame Example3"></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>

      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-catslab-trade-02-run-post" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/catslab_blog/catslab-trade-02-run-post/">A.2 Trade 실행</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/catslab_blog/catslab-trade-02-run-post/" class="article-date">
	  <time datetime="2019-02-25T22:00:00.000Z" itemprop="datePublished">February 26, 2019</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>
 
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="A-2-Trade-실행"><a href="#A-2-Trade-실행" class="headerlink" title="A.2. Trade 실행"></a>A.2. Trade 실행</h2><p>BotContext로 지정한 BOT_NAME으로 context의 run 함수를 통해 Bot을 실행 시킬 수 있습니다.<br>(예: BOT_NAME.run())</p>
<p>Bot을 실행하게 되면 context를 생성할 때 입력한 정보들과 함수들을 이용하여, 1분 주기로 다음과 같은 과정을 반복합니다.</p>
<p><strong>A.2.1. 현금과 가상화폐 보유량을 업데이트</strong><br>make_orders에서 생성하여 거래소로 전송한 거래 주문의 거래 체결 여부와 취소 여부를 확인하여 자산의 보유 현황을 업데이트하는 과정을 진행합니다.</p>
<p><strong>A.2.2. 현재 자산의 현금가 추정치를 계산</strong><br>업데이트된 보유 자산을 이용하여 현재 자산들의 현금가격 추정치를 계산합니다.  </p>
<p><strong>A.2.3. initialize에서 입력한 safety setting의 조건을 만족하는지의 여부를 검사</strong><br>이전 단계에서 계산한 현금가의 추정치를 이용하여 사용자가 입력한 safety setting 조건의 만족 여부를 검사합니다. </p>
<p>이 단계에서 safety setting의 조건을 만족할 때, 사용자가 지정한 가동 중지의 여부에 따라 Bot의 가동을 중단 시키거나 계속해서 유지하게 됩니다.</p>
<p>아래의 과정은 Bot의 가동을 유지하는 경우에 진행됩니다.</p>
<p><strong>A.2.4. dataframe 업데이트</strong><br>사용자가 전략에 사용하기 위해 입력한 가상화폐와 분봉의 종류에 따라 dataframe 타입으로 캔들 데이터를 저장하는데, 1분 주기로 각 화폐와 각 분봉 별로 새롭게 캔들이 생성되었는지의 여부를 확인하여 dataframe을 업데이트 합니다.</p>
<p><strong>A.2.5. run_strategy 실행</strong><br>캔들 데이터 업데이트의 여부에 따라 전략에서 사용하는 지표를 업데이트 합니다. </p>
<p>새롭게 생성된 캔들 데이터가 존재하는 경우 업데이트 된 기점으로 새롭게 지표를 계산하여 저장합니다.</p>
<p><strong>A.2.6. make_orders 실행</strong><br>사용자가 지정한 과정을 거쳐 매수주문/매도주문/주문취소를 진행하는 함수를 실행합니다. </p>
<p>이 단계에서 생성한 매수주문/매도주문은 set_order 함수를 이용하여 주문내역에 저장하고, set_cancel 함수를 이용하여 기존에 전송한 주문에 대한 주문취소 요청을 진행합니다.</p>
<p><strong>A.2.7. 거래소 API를 이용하여 거래소로의 주문 요청</strong><br>이전 단계인 make_orders에서 생성한 주문들을 거래소 API를 사용하여 거래소로 주문 요청을 진행합니다. </p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>

      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-catslab-trade-03-initialize-post" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/catslab_blog/catslab-trade-03-initialize-post/">A.3 Initialze의 작성 및 사용 예시</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/catslab_blog/catslab-trade-03-initialize-post/" class="article-date">
	  <time datetime="2019-02-25T21:00:00.000Z" itemprop="datePublished">February 26, 2019</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>
 
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>A.3. initialize 함수의 작성 및 사용 예시</strong><br>Initialize 함수의 작성 형식은 다음과 같은 형식을 갖으며,<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(self)</span>:</span></span><br><span class="line">	self.context[‘trade_info’] = &#123;<span class="string">"EXCHANGE_NAME_1"</span>: &#123;</span><br><span class="line">					<span class="string">"currency"</span>: [], </span><br><span class="line">					<span class="string">"interval"</span>: [],</span><br><span class="line">					<span class="string">"fiat"</span>: FIAT</span><br><span class="line">					&#125;,</span><br><span class="line">				<span class="string">"EXCHANGE_NAME_2"</span>: &#123;</span><br><span class="line">					<span class="string">"currency"</span>: [],</span><br><span class="line">					<span class="string">"interval"</span>: [],</span><br><span class="line">					<span class="string">"fiat"</span>: FIAT</span><br><span class="line">					&#125;,</span><br><span class="line">			… , </span><br><span class="line">			</span><br><span class="line">				<span class="string">"safety_setting"</span>: &#123;</span><br><span class="line">					<span class="string">"profit_target"</span>: &#123;</span><br><span class="line">					<span class="string">"checked"</span>: bool,</span><br><span class="line">					<span class="string">"ratio"</span>: RATIO</span><br><span class="line">					&#125;,</span><br><span class="line">				<span class="string">"stop_loss"</span>:&#123;</span><br><span class="line">					<span class="string">"checked"</span>: bool,</span><br><span class="line">					<span class="string">"ratio"</span>: RATIO</span><br><span class="line">					&#125;,</span><br><span class="line">				<span class="string">"stop_on_sell"</span>: bool,</span><br><span class="line">				<span class="string">"trailing_stop"</span>: &#123;</span><br><span class="line">					<span class="string">"checked"</span>: bool,</span><br><span class="line">					<span class="string">"dec_ratio"</span>: RATIO,</span><br><span class="line">					<span class="string">"inc_ratio"</span>: RATIO</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure></p>
<p>실제로 작성한 예제는 다음과 같습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(self)</span>:</span></span><br><span class="line">self.context[<span class="string">'trade_info'</span>] = &#123;<span class="string">"coinone"</span>: &#123;</span><br><span class="line">					<span class="string">"currency"</span>: [<span class="string">"xrp"</span>],</span><br><span class="line">					<span class="string">"interval"</span>: [<span class="number">1</span>],</span><br><span class="line">					<span class="string">"fiat"</span>: <span class="string">"krw"</span></span><br><span class="line">					&#125;,</span><br><span class="line">			      <span class="string">"upbit"</span>: &#123;</span><br><span class="line">					<span class="string">"currency"</span>: [<span class="string">"xrp"</span>],</span><br><span class="line">					<span class="string">"interval"</span>: [<span class="number">1</span>],</span><br><span class="line">					<span class="string">"fiat"</span>: <span class="string">"krw"</span></span><br><span class="line">					&#125;, </span><br><span class="line">			<span class="string">"safety_setting"</span>: &#123;</span><br><span class="line">					<span class="string">"profit_target"</span>: &#123;</span><br><span class="line">					<span class="string">"checked"</span>: <span class="literal">True</span>, </span><br><span class="line">					<span class="string">"ratio"</span>: <span class="number">0.10</span>,</span><br><span class="line">						&#125;, </span><br><span class="line">			<span class="string">"stop_loss"</span>: &#123;</span><br><span class="line">					<span class="string">"checked"</span>: <span class="literal">False</span>, </span><br><span class="line">					<span class="string">"ratio"</span>: <span class="number">0.10</span></span><br><span class="line">						&#125;, </span><br><span class="line">			<span class="string">"stop_on_sell"</span>: <span class="literal">True</span>, </span><br><span class="line">			<span class="string">"trailing_stop"</span>: &#123;</span><br><span class="line">					<span class="string">"checked"</span>: <span class="literal">True</span>, </span><br><span class="line">					<span class="string">"dec_ratio"</span>: <span class="number">0.05</span>,</span><br><span class="line">					<span class="string">"inc_ratio"</span>: <span class="number">0.07</span></span><br><span class="line">						&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>
<p>각각의 파라미터들은 다음과 같은 속성을 갖습니다.</p>
<p><strong>A.3.1. “EXCHANGE_NAME”: {“currency”: [], “interval”: [], “fiat”: FIAT}</strong><br>Bot에서 사용할 거래소의 명칭 EXCHANGE_NAME을 key로 하여, 해당 거래소에서 사용할 가상화폐(currency)의 종류, 분봉(interval)의 종류, 기축화폐(fiat)의 정보를 dictionary 타입으로 입력합니다. </p>
<p><strong>A.3.1.1. “currency”: []</strong><br>EXCHANGE_NAME을 key값으로 하는 dictionary에서 가상화폐의 종류에 대한 정보는 “currency”를 key, 사용할 가상화폐의 종류가 저장된 list를 value값으로 합니다.<br>(예: “currency”: [“btc”, “xrp”, “eth”])</p>
<p><strong>A.3.1.2. “interval”: []</strong><br>A.2.2와 마찬가지로 사용할 분봉에 대한 정보는 “interval”을 key, 사용할 분봉의 종류가 저장된 list를 value값으로 합니다.<br>(예: “interval”: [1, 5, 60])</p>
<p><strong>A.3.1.3. “fiat”: FIAT</strong><br>거래소에서 사용하는 기축화폐의 정보의 경우 “fiat”를 key값으로 하고, string 타입의 FIAT를 value값으로 가집니다.<br>(예: “fiat”: “krw” 또는 “fiat”: “usd”)</p>
<p><strong>A.3.2. “safety_setting”: {“profit_target”:{}, “stop_loss”:{}, “stop_on_sell”:bool, “trailing_stop”:{}}</strong><br>Bot에서 사용할 safety setting에 대한 정보 역시 “safety_setting”을 key값으로 하는 dictionary 타입으로 입력합니다. </p>
<p><strong>A.3.2.1. “profit_target”: {“checked”: bool, “ratio”: RATIO}</strong><br>Bot에서 사용할 익절 조건(“profit_target”)으로, 초기 투입 금액의 입력한 RATIO 이상으로 수익이 발생했을 시에 자동으로 Bot을 중단시키는 조건입니다. </p>
<p>이 기능을 사용할 것인지에 대한 여부를 “checked”를 key값, bool 타입의 value값으로 입력하고, 익절 조건의 비율을 float 타입의 RATIO (0&lt;=RATIO&lt;=1)로 입력합니다.</p>
<p><strong>A.3.2.2. “stop_loss”: {“checked”: bool, “ratio”: RATIO}</strong><br>Bot에서 사용할 손절 조건(“stop_loss”)으로, 초기 투입 금액의 입력한 RATIO 이하으로 손해가 발생했을 시에 자동으로 Bot을 중단시키는 조건입니다. </p>
<p>이 기능을 사용할 것인지에 대한 여부를 “checked”를 key값, bool 타입의 value값으로 입력하고, 손절 조건의 비율을 float 타입의 RATIO (0&lt;=RATIO&lt;=1)로 입력합니다.</p>
<p><strong>A.3.2.3. “stop_on_sell”: bool</strong><br>safety setting의 조건을 만족하여 거래를 중단할 경우 보유하고 있던 가상화폐들을 청산할 것인지에 대한 여부를 “stop_on_sell”를 key값으로하여 bool 타입의 value를 입력합니다. </p>
<p><strong>A.3.2.4. “trailing_stop”: {“checked”: bool, “dec_ratio”: RATIO, “inc_ratio”: RATIO}</strong><br>Bot을 가동중에 입력한 RATIO(“inc_ratio”) 이상 수익이 발생한 경우, 이후 거래에서 “dec_ratio” 이하로 하락했을 시 Bot 가동을 중단시키는 기능입니다. </p>
<p>기능의 사용 여부를 “checked”를 key값, bool 타입의 value값으로 입력하고, 기능이 발동되는 기준인 상승 조건을 “inc_ratio”의 key값과 float 타입의 RATIO (0&lt;=RATIO&lt;=1)로 입력합니다. 상승 이후 하락 조건을 “dec_ratio”의 key값과 float 타입의 RATIO (0&lt;=RATIO&lt;=1)로 입력합니다. </p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>

      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-catslab-trade-04-run-strategy-post" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/catslab_blog/catslab-trade-04-run-strategy-post/">A.4 run_strategy 함수 작성 및 예시</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/catslab_blog/catslab-trade-04-run-strategy-post/" class="article-date">
	  <time datetime="2019-02-25T20:00:00.000Z" itemprop="datePublished">February 26, 2019</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>
 
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="A-4-run-strategy-함수의-작성-및-사용-예시"><a href="#A-4-run-strategy-함수의-작성-및-사용-예시" class="headerlink" title="A.4. run_strategy 함수의 작성 및 사용 예시"></a>A.4. run_strategy 함수의 작성 및 사용 예시</h2><p>1분 주기로 업데이트 되는 dataframe을 이용하여 사용자가 전략에서 사용하는 기술적 지표 및 매수/매도의 근거가 되는 전략을 계산하고 업데이트하는 함수입니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_strategy</span><span class="params">(self, is_update, trade_info, update_len, data)</span>:</span></span><br></pre></td></tr></table></figure>
<p><strong>A.4.1. is_update (dict)</strong><br>is_update parameter는 가상화폐와 분봉의 종류에 따라 “{currency}_{interval}” 형태의 key값과, 해당 분봉의 update 여부에 따라 bool 타입의 value값을 갖습니다. </p>
<p>예를 들어, 1분을 주기로 Trade 함수(A.2. 참고)가 진행될 때, 1분마다 생성되는 1분봉의 경우 매분 새롭게 캔들 데이터가 생성되어 dataframe 업데이트가 진행됩니다. </p>
<p>이외의 분봉들은 해당 분봉이 생성되고 나서 dataframe 업데이트의 여부에 따라 bool 타입의 value값이 is_update에 저장됩니다.</p>
<p><strong>A.4.2. trade_info (dict)</strong><br>전략에서 사용하는 거래소, 가상화폐, 분봉의 종류 및 safety setting에 대한 정보를 저장하고 있는 parameter입니다. 초기에 BotContext를 생성할 때 initialize(A.3. 참고)에서 입력한 정보들과 같습니다.</p>
<p><strong>A.4.3. update_len (dict)</strong><br>각각의 가상화폐와 분봉에 따라 1분 주기로 dataframe의 업데이트 여부를 is_update에 저장하는 것과 동시에 업데이트 된 캔들 데이터의 개수가 update_len에 저장됩니다. </p>
<p>is_update와 마찬가지로 “{currency}_{interval}” 형태의 key값을 가지고, 업데이트 된 캔들 데이터의 개수를 value값으로 가집니다. </p>
<p>이 parameter는 실제 거래소에서 캔들 데이터가 생성되더라도 크롤링이나 거래소 API를 이용하여 데이터를 호출하는 과정에서 업데이트 되어야할 캔들 데이터가 누락 또는 지연이 되거나, 거래소 점검으로 인해 업데이트 되는 캔들 데이터가 없는 경우를 구분하기 위해 사용합니다.</p>
<p><strong>A.4.4. data (dict)</strong><br>전략에서 사용하기 위해 입력한 가상화폐의 종류와 분봉의 종류에 따라 “{currency}_{interval}” 형태의 key값과 dataframe을 value값으로 갖는 dictionary입니다. </p>
<p>각 dataframe에는 해당 가상화폐와 분봉의 캔들 데이터 및 전략에서 사용되는 기술적 지표들이 저장되어 있습니다. </p>
<p>또한, 각 분봉마다 가지고 있는 default 개수만큼을 가장 최근에 업데이트 된 캔들 데이터까지 저장하고 있습니다. </p>
<p>각 분봉의 default 개수는 다음과 같습니다.<br>1분봉         : 10080개 (1주일)<br>3분봉         : 3360개 (1주일)<br>5분봉         : 8640개 (1개월)<br>15분봉        : 2880개 (1개월)<br>30분봉        : 1440개 (1개월)<br>60분봉        : 2160개 (3개월)<br>120분봉    : 1080개 (3개월)<br>240분봉    : 540개 (3개월)<br>1440분봉    : 365개 (1년)</p>
<p>run_strategy 함수의 사용 예시는 5일 이동평균선과 20일 이동평균선을 사용하는 전략으로 다음과 같습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> coza.ta <span class="keyword">import</span> candle_slicing</span><br><span class="line"><span class="keyword">from</span> coza.ta <span class="keyword">import</span> ema</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_strategy</span><span class="params">(self, is_update, trade_info, update_len, data)</span>:</span></span><br><span class="line">    exchange = self.exchange</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> currency <span class="keyword">in</span> trade_info[exchange][<span class="string">'currency'</span>]:</span><br><span class="line">        <span class="keyword">for</span> interval <span class="keyword">in</span> trade_info[exchange][<span class="string">'interval'</span>]:</span><br><span class="line">            <span class="keyword">if</span> int(interval) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> len(is_update.keys()) != <span class="number">0</span>:</span><br><span class="line">                    update_number = update_len[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>]</span><br><span class="line"></span><br><span class="line">                    update_candle_20 = \</span><br><span class="line">                    candle_slicing(df=df, n=<span class="number">20</span>, update_number=update_number)</span><br><span class="line">                    update_candle_60 = \</span><br><span class="line">                    candle_slicing(df=df, n=<span class="number">60</span>, update_number=update_number)</span><br><span class="line"></span><br><span class="line">                    update_ema_20 = \</span><br><span class="line">                    ema(update_candle_20[<span class="string">'close'</span>], <span class="number">20</span>).tail(update_number)</span><br><span class="line">                    update_ema_60 = \</span><br><span class="line">                    ema(update_candle_60[<span class="string">'close'</span>], <span class="number">60</span>).tail(update_number)</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> update_number &gt;= <span class="number">1</span>:</span><br><span class="line">                        start_index_20 = update_ema_20.index[<span class="number">0</span>]</span><br><span class="line">                        start_index_60 = update_ema_60.index[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">for</span> index <span class="keyword">in</span> range(update_number):</span><br><span class="line">                            data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>].set_value(start_index+timedelta(days=index), <span class="string">'ema_20'</span>, update_ema_20.loc[start_index+timedelta(days=index)])</span><br><span class="line">                            data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>].set_value(start_index+timedelta(days=index), <span class="string">'ema_60'</span>, update_ema_60.loc[start_index+timedelta(days=index)])</span><br><span class="line">                        </span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'ema_20'</span>] = \</span><br><span class="line">                    ema(data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'close'</span>], <span class="number">20</span>)</span><br><span class="line">                    data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'ema_60'</span>] = \</span><br><span class="line">                    ema(data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'close'</span>], <span class="number">60</span>)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>

      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-catslab-trade-05-make-orders-post" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/catslab_blog/catslab-trade-05-make-orders-post/">A.5 make_orders 함수의 작성 및 예시</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/catslab_blog/catslab-trade-05-make-orders-post/" class="article-date">
	  <time datetime="2019-02-25T19:00:00.000Z" itemprop="datePublished">February 26, 2019</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>
 
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="A-5-make-orders-함수의-작성-및-예시"><a href="#A-5-make-orders-함수의-작성-및-예시" class="headerlink" title="A.5. make_orders 함수의 작성 및 예시"></a>A.5. make_orders 함수의 작성 및 예시</h2><p>전략에서 사용하는 매수/매도 방식에 따라 매수주문/매도주문/주문취소를 진행합니다. </p>
<p>주문을 생성할 때는 Order 객체를 이용하여 생성하고, 생성한 주문들은 set_order 함수를 이용하여 주문 내역에 저장합니다. </p>
<p>주문 내역에 있는 주문들은 거래소 API를 이용하는 내부 함수를 사용하여 거래소로 전송됩니다. 주문 취소의 경우 set_cancel을 통해 거래소로 전송이 가능합니다.</p>
<p>주문을 생성하는 Order 객체 생성은 A.6.을 참고하시고, 생성한 주문을 거래소에 전송하기 위해 list에 추가하는 set_order 함수는 A.7.을 참고하시기 바랍니다. 또한, 체결 이전의 주문들의 정보를 저장하고 있는 order_list에 대한 내용은 A.8.에서, 주문 취소를 요청하는 set_cancel 함수에 대한 설명과 사용 방법은 A.9.을 참고하시기 바랍니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_orders</span><span class="params">(self, is_update, trade_info, update_len, data)</span>:</span></span><br></pre></td></tr></table></figure>
<p><strong>A.5.1. is_update (dict)</strong><br>run_strategy 함수의 parameter와 동일합니다.</p>
<p><strong>A.5.2. trade_info (dict)</strong><br>run_strategy 함수의 parameter와 동일합니다.</p>
<p><strong>A.5.3. update_len (dict)</strong><br>run_strategy 함수의 parameter와 동일합니다.</p>
<p><strong>A.5.4. data (dict)</strong><br>run_strategy 함수의 parameter와 동일합니다.</p>
<p>make_orders 함수의 사용 예시는 다음과 같습니다.</p>
<p>다음 예시는 위의 run_strategy를 기반으로 5일 이동평균선이 20일 이동평균선을 상향 돌파하는 순간 매수, 하향 돌파하는 순간 매도하는 전략입니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_orders</span><span class="params">(self, is_update, trade_info, update_len, data)</span>:</span></span><br><span class="line">    exchange = self.exchange</span><br><span class="line">    interval = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    total_fiat = self.exchanges[exchange].balance[<span class="string">'fiat'</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> currency <span class="keyword">in</span> trade_info[exchange][<span class="string">'currency'</span>]:</span><br><span class="line">        current_index = data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>].index[<span class="number">-1</span>]</span><br><span class="line">        t = current_index</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'ema_20'</span>].loc[current_index-timedelta(seconds=<span class="number">60</span>)] \</span><br><span class="line">        &lt; data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'ema_60'</span>].loc[current_index-timedelta(seconds=<span class="number">60</span>)] \</span><br><span class="line">        <span class="keyword">and</span> data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'ema_20'</span>].loc[current_index] \</span><br><span class="line">        &gt; data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'ema_60'</span>].loc[current_index]:</span><br><span class="line">            order_type = <span class="string">'BUY'</span></span><br><span class="line">            price = data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'close'</span>].loc[current_index]</span><br><span class="line">            quantity = math.floor( round (total_fiat*<span class="number">0.5</span> / price * <span class="number">10</span>**<span class="number">4</span>, <span class="number">4</span>) )/(<span class="number">10</span>**<span class="number">4</span>)</span><br><span class="line">            <span class="keyword">if</span> quantity &gt;= <span class="number">1.0</span> <span class="keyword">and</span> price * quantity &lt;= self.exchanges[exchange].balance[<span class="string">'fiat'</span>]:</span><br><span class="line">                o = Order(exchange=exchange, currency=currency, order_type=order_type, fiat=<span class="string">'krw'</span>, price=price, quantity=quantity)</span><br><span class="line">                self.set_order(exchange=exchange, o=o, t=t)</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">elif</span> data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'ema_20'</span>].loc[current_index-timedelta(seconds=<span class="number">60</span>)] \</span><br><span class="line">        &gt; data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'ema_60'</span>].loc[current_index-timedelta(seconds=<span class="number">60</span>)] \</span><br><span class="line">        <span class="keyword">and</span> data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'ema_20'</span>].loc[current_index] \</span><br><span class="line">        &lt; data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'ema_60'</span>].loc[current_index]:</span><br><span class="line">            order_type = <span class="string">'SELL'</span></span><br><span class="line">            price = data[<span class="string">f'<span class="subst">&#123;currency&#125;</span>_<span class="subst">&#123;int(interval)&#125;</span>'</span>][<span class="string">'close'</span>].loc[current_index]</span><br><span class="line">            quantity = math.floor(round(self.exchanges[exchange].balance[currency][<span class="string">'avail'</span>] * <span class="number">10</span>**<span class="number">4</span>, <span class="number">4</span>))/(<span class="number">10</span>**<span class="number">4</span>)</span><br><span class="line">            <span class="keyword">if</span> quantity &gt;= <span class="number">1.0</span>:</span><br><span class="line">                o = Order(exchange=exchange, currency=currency, order_type=order_type, fiat=<span class="string">'krw'</span>, price=price, quantity=quantity)</span><br><span class="line">                self.set_order(exchange=exchange, o=o, t=t)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>

      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-catslab-trade-06-order-post" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/catslab_blog/catslab-trade-06-order-post/">A.6 Order 객체 생성 및 사용 예시</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/catslab_blog/catslab-trade-06-order-post/" class="article-date">
	  <time datetime="2019-02-25T18:00:00.000Z" itemprop="datePublished">February 26, 2019</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>
 
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="A-6-Order-객체-생성-및-사용-예시"><a href="#A-6-Order-객체-생성-및-사용-예시" class="headerlink" title="A.6. Order 객체 생성 및 사용 예시"></a>A.6. Order 객체 생성 및 사용 예시</h2><p>거래소에 주문을 전송하기 전에 Order 객체를 생성하여 list에 저장을 한 뒤, 거래소 API를 이용하는 함수를 사용하여 list에 저장되어 있는 주문들을 한 번에 처리합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span><span class="params">(exchange, currency, order_type, quantity, price, fiat)</span>:</span></span><br></pre></td></tr></table></figure>
<p><strong>A.6.1. exchange (str)</strong><br>주문할 거래소의 명칭을 입력합니다.<br>(예: ‘coinone’, ‘upbit’)</p>
<p><strong>A.6.2. currency (str)</strong><br>거래소에 주문을 넣을 가상 화폐의 명칭을 입력합니다.<br>(예: “btc”, “eth”, “xrp”, … )</p>
<p><strong>A.6.3. order_type (str)</strong><br>매수와 매도를 구분하기 위한 parameter입니다.<br>매수 주문의 경우 “BUY”, 매도 주문의 경우 “SELL” 타입으로 입력합니다.</p>
<p><strong>A.6.4. quantity (float)</strong><br>주문할 가상화폐의 수량을 입력합니다.</p>
<p><strong>A.6.5. price (int)</strong><br>주문할 가상화폐의 가격을 입력합니다.</p>
<p><strong>A.6.6. fiat (str)</strong><br>거래소에서 사용하는 기축화폐를 입력합니다.<br>(예: “krw”, “usd”, … )</p>
<p>Order 객체의 사용 예시는 다음과 같습니다.</p>
<p>매수주문 (현재 가격으로 주문): </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> coza.objects <span class="keyword">import</span> Order</span><br><span class="line"></span><br><span class="line">price = data[<span class="string">f'<span class="subst">&#123;currency]_&#123;int(interval)&#125;</span>'</span>][<span class="string">'close'</span>].loc[data[<span class="string">f'<span class="subst">&#123;currency]_&#123;int(interval)&#125;</span>'</span>].index[<span class="number">-1</span>]]</span><br><span class="line">buy_order = Order(exchange=<span class="string">'coinone'</span>, currency=<span class="string">'xrp'</span>, order_type=<span class="string">'BUY'</span>, fiat=<span class="string">'krw'</span>, price=price, quantity=<span class="number">2.5</span>)</span><br></pre></td></tr></table></figure>
<p>매도주문 (지정가 주문):<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> coza.objects <span class="keyword">import</span> Order</span><br><span class="line"></span><br><span class="line">sell_order = Order(exchange=<span class="string">'upbit'</span>, currency=<span class="string">'eth'</span>, order_type=<span class="string">'SELL'</span>, fiat=<span class="string">'krw'</span>, price=<span class="number">150000</span>, quantity=<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a>, <a class="article-category-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a>

      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/catslab_blog/page/2/">2</a><a class="extend next" rel="next" href="/catslab_blog/page/2/">Next</a>
  </nav>

</section>
          <aside id="sidebar">
  
    <div style="margin: 20px 0;">
	<div id="search-form-wrap">

    <form class="search-form">
        <label style="width: 72%;">
            <span class="screen-reader-text">Search for:</span>
            <input type="search" class="search-field" style="height: 36px; width: 100%;" placeholder=" Search…" value name="s" title="Search for:">
        </label>
        <input type="submit" class="search-form-submit" value="Search">
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/catslab_blog/',
        CONTENT_URL: '/catslab_blog/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/catslab_blog/js/insight.js"></script>

</div>
</div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Connect With Us</h3>
    <div class="widget widget_athemes_social_icons">

    	<ul class="clearfix widget-social-icons">   
    	
   			<li><a href="https://github.com/iTimeTraveler" title="Github"><i class="fa fa-github" aria-hidden="true"></i></a></li> 

   		
   			<li><a href title="Weibo"><i class="fa fa-weibo" aria-hidden="true"></i></a></li> 

   		
   			<li><a href title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a></li> 

   		
   			<li><a href title="Facebook"><i class="fa fa-facebook" aria-hidden="true"></i></a></li> 

   		
   			<li><a href title="Google-plus"><i class="fa fa-google-plus" aria-hidden="true"></i></a></li> 

   		
   			<li><a href title="Instagram"><i class="fa fa-instagram" aria-hidden="true"></i></a></li> 

   		
   		</ul>


   		<!--
   		<ul class="clearfix widget-social-icons">   		
   		<li class="widget-si-twitter"><a href="http://twitter.com" title="Twitter"><i class="ico-twitter"></i></a></li> 
		<li class="widget-si-facebook"><a href="http://facebook.com" title="Facebook"><i class="ico-facebook"></i></a></li>
			<li class="widget-si-gplus"><a href="http://plus.google.com" title="Google+"><i class="ico-gplus"></i></a></li>
			<li class="widget-si-pinterest"><a href="http://pinterest.com" title="Pinterest"><i class="ico-pinterest"></i></a></li>
			<li class="widget-si-flickr"><a href="http://flickr.com" title="Flickr"><i class="ico-flickr"></i></a></li>
			<li class="widget-si-instagram"><a href="http://instagram.com" title="Instagram"><i class="ico-instagram"></i></a></li>
		</ul> -->

    </div>
  </div>


  
    
  <div class="widget_athemes_tabs">
    <ul id="widget-tab" class="clearfix widget-tab-nav">
      <li class="active"><a>Recent Posts</a></li>
    </ul>
    <div class="widget">
      <ul>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/catslab_blog/k8s-AWS-settings/">AWS Settings and Installation</a></h6>
              <span>April 27, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/catslab_blog/k8s-kops-cluster/">k8s Cluster on AWS with Kops</a></h6>
              <span>April 27, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/catslab_blog/catslab-package-installation/">CATS Lab Package Installation</a></h6>
              <span>April 26, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/catslab_blog/catslab-trade-00-base-post/">A.0 Trade Basic</a></h6>
              <span>February 26, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/catslab_blog/catslab-trade-01-botcontext-post/">A.1 BotContext의 생성</a></h6>
              <span>February 26, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/catslab_blog/catslab-trade-02-run-post/">A.2 Trade 실행</a></h6>
              <span>February 26, 2019</span>
            </div>

          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/CATS-LAB/">CATS LAB</a><span class="category-list-count">18</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/CATS-LAB/Backtest/">Backtest</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/CATS-LAB/Backtest/B-0-Backtest-기본/">B.0 Backtest 기본</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/CATS-LAB/Backtest/B-1-BacktestContext의-생성/">B.1 BacktestContext의 생성</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/CATS-LAB/Backtest/B-2-Backtest-실행/">B.2 Backtest 실행</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/CATS-LAB/Backtest/B-3-B-6-initialize-run-strategy-make-orders-Order-작성/">B.3 ~ B.6 initialize run_strategy make_orders Order 작성</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/CATS-LAB/Backtest/B-7-Result-객체의-생성-및-사용-예시/">B.7 Result 객체의 생성 및 사용 예시</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/CATS-LAB/Backtest/B-8-plot-함수의-사용-방법-및-사용-예시/">B.8 plot 함수의 사용 방법 및 사용 예시</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/CATS-LAB/Installation/">Installation</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/CATS-LAB/Trade/">Trade</a><span class="category-list-count">11</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/Kubernetes/">Kubernetes</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/Kubernetes/AWS-Settings-Installation/">AWS Settings & Installation</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/catslab_blog/categories/Kubernetes/k8s-Cluster-on-AWS-with-Kops/">k8s Cluster on AWS with Kops</a><span class="category-list-count">1</span></li></ul></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>

    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/catslab_blog/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/catslab_blog/archives/2019/02/">February 2019</a><span class="archive-list-count">17</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/catslab_blog/" class="mobile-nav-link">Home</a>
  
    <a href="/catslab_blog/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/catslab_blog/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/catslab_blog/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/catslab_blog/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2019 CATSLAB BLOG All Rights Reserved.
        
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
    
</script>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/catslab_blog/fancybox/jquery.fancybox.css">
  <script src="/catslab_blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/catslab_blog/js/script.js"></script>
<script src="/catslab_blog/js/bootstrap.js"></script>
<script src="/catslab_blog/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
